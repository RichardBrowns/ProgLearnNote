# 基础

## 什么是CAP理论

CAP理论是指在分布式系统中，无法同时满足一致性、可用性和分区容错性，最多满足其中两个。

- **一致性(Consistency)**：指所有节点在同一时间具有相同数据。即当一个节点更新数据后，其他节点读取数据都会返回最新的值。
- **可用性(Availability)**：指的是每次请求无论成功或者失败都要有响应，而不会让客户挂起或等待。
- **分区容错性(Partition tolerance)**：是指遇到网络分区故障，分布式系统仍需正常运行。

根据CAP理论，分布式系统可以分为以下三种类型：

1. CA系统：强调一致性和可用性，放弃分区容错性。实际上不可能，分布式系统当然要允许分区容错性。
2. CP系统：强调一致性和分区容错性，放弃可用性。出现网络分区时，优先保证数据的一致性，可能会拒绝读写操作，等待网络恢复。
3. AP系统：强调可用性和分区容错性，放弃一致性。出现网络分区时，优先保证数据的可用性，允许数据一段时间不一致，最终保证一致。

## 什么是BASE理论

BASE理论是对CAP理论的妥协，BASE理论强调的是在分布式系统中，我们不需要强一致性，而是可以通过牺牲一些一致性来换取更好的可用性和更高的性能。BASE理论的三个关键词分别是：

- **基本可用(Basically Available)**：系统必须保证基本的可用性，即使是在出现网络故障的时候。
- **软状态(Soft state)**：允许系统中的数据存在中间状态。
- **最终一致性(Eventually consistent)**：系统中的所有数据保证最终到达一致的状态。

## 什么是分布式一致性？有哪些常见的分布式一致性模型？

分布式一致性是指在分布式系统当中，多个节点之间保持数据一致性的能力。常见的分布式一致性模型如下：

1. **强一致性（Strong Consistency）**：要求所有节点在任何时候都看到相同的数据状态。强一致性对系统的可用性和性能有影响，适合银行转账等对数据一致性要求高的业务场景。
2. **弱一致性（Weak Consistency）**：不保证数据一致，也不必保证多久后数据会一致
3. **最终一致性（Eventual Consistency）**：保证数据在经过一段时间后，所有节点将自动达到一致的状态

## 解释一下两阶段提交（2PC）和三阶段提交（3PC）的区别

两阶段提交和三阶段提交是分布式系统实现分布式事务的两种协议，主要用于保证跨多个节点的事务操作能够原子性地完成。

**两阶段提交（2PC）**

两阶段提交是一种用于分布式系统中保证事务一致性的协议。它包括协调者（coordinator）和参与者（participant）角色。

**流程**

1. **投票阶段**：协调者向所有参与者发送事务准备请求，并等待参与者的响应。
2. **提交阶段**：如果所有参与者都同意事务提交，则协调者向所有参与者发送事务提交请求，参与者执行提交操作。

**问题**

- **阻塞：**可能出现的问题包括网络分区导致的长时间等待，可能会导致系统出现阻塞
- **单点故障**：协调者故障会导致系统无法进入提交阶段。

**三阶段提交（3PC）**

三阶段提交是对两阶段提交的改进，旨在解决长时间阻塞和单点故障的问题。

**流程**

1. **CanCommit阶段**：协调者询问所有参与者是否可以提交事务。
2. **PreCommit阶段**：协调者要求参与者做出预提交，并等待参与者的响应。
3. **Commit阶段**：如果预提交成功，则协调者发出最终提交请求，否则发出中止请求。

**改进**

- **超时机制：**引入超时机制，避免长时间等待。
- **中断处理：**在CanCommit和PreCommit阶段引入中断处理，避免单点故障的影响。





1. **基础知识理解**：
   - 请解释一下CAP理论以及BASE理论。
   - 什么是分布式一致性？有哪些常见的分布式一致性模型？
   - 解释一下两阶段提交（2PC）和三阶段提交（3PC）的区别。
2. **分布式存储与数据库**：
   - 如何处理分布式环境下的数据一致性问题？
   - 请描述几种常用的分布式数据库及其适用场景。
   - 分布式缓存如何解决缓存与数据库的数据一致性问题？
3. **微服务架构**：
   - 微服务架构中，如何保证服务间的通信安全？
   - 在微服务架构下，如何处理服务之间的依赖关系和故障传播？
   - 解释API网关的作用以及它在微服务架构中的位置。
4. **负载均衡与高可用性**：
   - 负载均衡器是如何工作的？有哪些常见的负载均衡策略？
   - 如何设计一个高可用的分布式系统？
   - 解释一下熔断、降级和重试机制在分布式系统中的作用。
5. **消息队列与事件驱动架构**：
   - 消息队列在分布式系统中的作用是什么？
   - 解释一下同步与异步调用的区别，并说明在什么情况下使用它们。
   - 如何处理消息队列中的死信消息？
6. **分布式事务**：
   - 什么是分布式事务？它与本地事务有何不同？
   - 解释一下SAGA模式在分布式事务中的应用。
7. **分布式系统的设计原则与挑战**：
   - 设计分布式系统时，你认为最重要的几个设计原则是什么？
   - 面对分布式系统的复杂性，你如何进行系统监控和故障排查？